<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cosmopedia — cosmok</title>
  <meta name="description" content="Opslagsværk for kampagnen: steder, personer, begivenheder. Wikisider kan linke til hinanden." />
  <meta property="og:title" content="Cosmipedia — cosmok" />
  <meta property="og:description" content="Wiki med facts, navne og særlige begivenheder i Spelljammer-verdenen." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <link rel="icon" href="../assets/favicon.svg">
  <link rel="stylesheet" href="../assets/css/base.css" />
  <style>
    /* Søg + filtre (chips) */
    .search { display:flex; gap:.5rem; align-items:center; margin-block:1rem 1rem; }
    .search input { flex:1; padding:.75rem 1rem; border-radius:999px; border:1px solid var(--surface-3); background:var(--surface-1); color:var(--text); }
    .filters { display:flex; flex-wrap:wrap; gap:.5rem; margin-bottom:1rem; }
    .chip { display:inline-flex; align-items:center; gap:.4rem; padding:.45rem .9rem; border-radius:999px; border:1px solid var(--surface-3); background:var(--surface-2); color:var(--text); font-weight:600; cursor:pointer; }
    .chip[aria-pressed="true"]{ background: var(--primary); color:#1a1200; border-color:#e6c036; }
    .chip .count{ opacity:.7; font-weight:700; }
    .wiki article { padding:1rem; border:1px solid var(--surface-3); border-radius:16px; background:var(--surface-1); box-shadow: var(--shadow-1); }
    .wiki article + article { margin-top:1rem; }
    .wiki h2 { display:flex; align-items:baseline; gap:.5rem; }
    .permalink { font-size:.9rem; text-decoration:none; border:1px solid var(--surface-3); padding:.1rem .5rem; border-radius:999px; }
    .taxonomy { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.5rem; }
    .tag { font-size:.85rem; padding:.2rem .6rem; border-radius:999px; background:var(--surface-2); border:1px solid var(--surface-3); cursor:pointer; }
    .muted { color: var(--text-dim); font-size:.95rem; }
    @media (prefers-reduced-motion:no-preference){
      .wiki article{ transition: transform .2s ease, opacity .2s ease; }
      .wiki article[hidden]{ opacity:0; transform: translateY(4px); }
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Spring til indhold</a>

  <header class="site-header" role="banner">
    <div class="wrap">
      <a class="brand" href="../">
        <span class="icon" aria-hidden="true">✦</span>
        <span class="wordmark">cosmo<span class="mark">k</span></span>
      </a>
      <nav class="site-nav" aria-label="Global navigation">
        <ul>
          <li><a href="../next/">Næste session</a></li>
          <li><a href="../map/">Kort</a></li>
          <li><a href="../wiki/" aria-current="page">Cosmopedia</a></li>
          <li><a href="../handouts/">Handouts</a></li>
          <li><a href="../rules/">Husregler</a></li>
          <li><a href="../crew/">Crew</a></li>
        </ul>
      </nav>
    </div>
  </header>

    <main id="main" class="wrap">
    <header class="page-intro">
      <h1>Cosmipedia</h1>
      <div class="search">
        <label for="q" class="sr-only">Søg i wiki</label>
        <input id="q" type="search" placeholder="Søg: steder, personer, begivenheder …" aria-describedby="count">
        <span id="count" class="muted"></span>
      </div>
      <div class="filters" id="filters" role="toolbar" aria-label="Filtrer efter tags">
        <!-- chips tilføjes via JS. En 'Vis alt' chip oprettes altid -->
      </div>
    </header>

    <section class="wiki" aria-label="Wikiartikler">

      <!-- Wiki artikel skebelon:
      <article id="Navn_på_artiklen">
        <h2>Artikel_overskrift <a class="permalink" href="#sti_ved_tryk_på_#_linkknap" aria-label="Kopier link til Navn_på_artiklen">#</a></h2>
        <p>Brødtekst_beskrivelse_<q>blabla</q>="blabla"sådan_sætter_man_i_siturationstegn.</p>
        <p>Se også: <a href="#Navn_på_en_anden_artikel">Navn_på_en_anden_artikel</a>, <a href="#Navn_på_en_tredje_artikel">“Navn_på_en_tredje_artikel”</a>.</p>
        <div class="taxonomy"><span class="tag">Små_tags_nederst_på_artikeln</span><span class="tag">Små_tags_nederst_på_artikeln</span></div>
      </article>
-->
      
      <article id="maanebyen">
        <h2>Månebyen <a class="permalink" href="#maanebyen" aria-label="Kopier link til Månebyen">#</a></h2>
        <p>Byen der . <em>Alt</em> kan købes — men aldrig billigt.</p>
        <p>Se også: <a href="#store-luigi">Store Luigi</a>, <a href="#docking-inspektion">Karen</a>, <a href="#mas-vegas">Más&nbsp;Vegas</a>.</p>
        <div class="taxonomy"><span class="tag">Sted</span><span class="tag">Handel</span></div>
      </article>
      
      <article id="mas-vegas">
        <h2>Más Vegas <a class="permalink" href="#mas-vegas" aria-label="Kopier link til Más Vegas">#</a></h2>
        <p>En neon-ørkenstation hvor held er en ressource — og gæld er tyngdekraft.</p>
        <p>Se også: <a href="#vip-pass">VIP-pass</a>, <a href="#sir-lumen">Sir Lumen</a>.</p>
        <div class="taxonomy"><span class="tag">Sted</span><span class="tag">Chance</span></div>
      </article>

      
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>© cosmok — Spelljammerkampagne. <em>‘Stjernesirup til pumperne. CosmoGum til gummerne.’</em></p>
    </div>
  </footer>

  <!-- originale søgnings filter
  <script>
    // Minimal, lokal søgning i wiki (ingen libs)
    const input = document.getElementById('q');
    const articles = Array.from(document.querySelectorAll('.wiki article'));
    const count = document.getElementById('count');
    function filter() {
      const q = input.value.trim().toLowerCase();
      let visible = 0;
      articles.forEach(a => {
        const hit = a.textContent.toLowerCase().includes(q);
        a.style.display = hit ? '' : 'none';
        if (hit) visible++;
      });
      count.textContent = q ? `${visible} resultat(er)` : '';
    }
    input.addEventListener('input', filter);
  </script>
</body>
</html>
-->

<script>
// nyt søgnings filter
    // --- Hjælpere ---
    const byId = (id)=>document.getElementById(id);
    const norm = s => s.trim().toLowerCase();
    // Synonymer/kanoniske chips (du kan udvide listen)
    const ALIASES = {
      "npc": ["npc"],
      "lokation": ["sted", "lokation", "location"],
      "begivenhed": ["begivenhed", "event", "hændelse"],
      "kvantemekanik": ["kvantemekanik", "mekanik"],
      "mekanik": ["mekanik"],
      "handel": ["handel"],
      "station": ["station"],
      "viden": ["viden"],
      "chance": ["chance"]
    };

    // --- Opsamling af artikler og tags ---
    const input = byId('q');
    const count = byId('count');
    const articles = Array.from(document.querySelectorAll('.wiki article'));
    // Læs tags fra DOM og gem på elementet
    articles.forEach(a=>{
      const tags = Array.from(a.querySelectorAll('.tag')).map(t => norm(t.textContent));
      a.dataset.tags = tags.join(',');
    });
    // Find alle tags der faktisk findes
    const presentTags = new Set(articles.flatMap(a => a.dataset.tags ? a.dataset.tags.split(',') : []));

    // --- Byg filter-chips ---
    const filters = byId('filters');
    function makeChip(label, pressed=false){
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'chip';
      btn.dataset.key = label;                      // visningsnavn (kanonisk)
      btn.dataset.tags = (ALIASES[label]||[label]).join(','); // hvilke under-tags den matcher
      btn.setAttribute('aria-pressed', pressed ? 'true' : 'false');
      btn.innerHTML = `${label[0].toUpperCase()+label.slice(1)} <span class="count" aria-hidden="true"></span>`;
      return btn;
    }

    // Start med "Vis alt"
    const chipAll = document.createElement('button');
    chipAll.type='button';
    chipAll.className='chip';
    chipAll.dataset.key='__all';
    chipAll.setAttribute('aria-pressed','true');
    chipAll.textContent='Vis alt';
    filters.appendChild(chipAll);

    // Bestil rækkefølge: ønskede chips først, derefter resten der findes på siden
    const preferred = ["npc","lokation","begivenhed","kvantemekanik","mekanik","handel","station","viden","chance"];
    const extras = Array.from(presentTags).filter(t => !preferred.includes(t));
    const order = [...preferred, ...extras];

    order.forEach(key => {
      const btn = makeChip(key, false);
      filters.appendChild(btn);
    });

    // --- State & filterlogik ---
    const state = {
      query: '',
      selected: new Set() // kanoniske keys fra ALIASES eller rå tag-navne
    };

    function selectedExpanded(){
      // Udvid valgte til konkrete tags (OR-logik)
      const out = new Set();
      for (const k of state.selected){
        const list = ALIASES[k] || [k];
        list.forEach(t=>out.add(norm(t)));
      }
      return out;
    }

    function applyFilter(){
      const q = state.query;
      const tagSet = selectedExpanded(); // konkrete tag-navne
      let visible = 0;
      articles.forEach(a=>{
        const textHit = q ? a.textContent.toLowerCase().includes(q) : true;
        const tags = a.dataset.tags ? a.dataset.tags.split(',') : [];
        const tagHit = tagSet.size === 0 ? true : tags.some(t => tagSet.has(norm(t)));
        const show = textHit && tagHit;
        a.hidden = !show;
        if (show) visible++;
      });
      count.textContent = (q || state.selected.size) ? `${visible} resultat(er)` : '';
      // Opdater små counts på chips (hvor mange artikler matcher chippen, uafh. af søgning)
      Array.from(filters.querySelectorAll('.chip')).forEach(ch=>{
        const tlist = ch.dataset.tags ? ch.dataset.tags.split(',').map(norm) : [];
        if (ch.dataset.key === '__all'){
          ch.querySelector?.('.count')?.remove?.();
          return;
        }
        const c = articles.filter(a=>{
          const tags = a.dataset.tags ? a.dataset.tags.split(',') : [];
          return tags.some(t=>tlist.includes(norm(t)));
        }).length;
        const span = ch.querySelector('.count');
        if (span) span.textContent = c ? `(${c})` : '';
      });
      // Opdatér hash
      const sel = Array.from(state.selected);
      const hash = sel.length ? `#tag=${encodeURIComponent(sel.join(','))}` : '';
      if (location.hash !== hash){
        history.replaceState(null,'',hash || ' ');
      }
      // Aktivér/deaktivér "Vis alt"
      chipAll.setAttribute('aria-pressed', state.selected.size ? 'false' : 'true');
    }

    // --- Events ---
    // Søg
    input.addEventListener('input', e=>{
      state.query = e.target.value.trim().toLowerCase();
      applyFilter();
    });

    // Klik på chips
    filters.addEventListener('click', e=>{
      const btn = e.target.closest('.chip');
      if (!btn) return;
      const key = btn.dataset.key;
      if (key === '__all'){
        // nulstil
        state.selected.clear();
        // Nulstil aria-pressed på alle andre
        filters.querySelectorAll('.chip').forEach(c=>{
          if (c.dataset.key !== '__all') c.setAttribute('aria-pressed','false');
        });
      } else {
        const pressed = btn.getAttribute('aria-pressed') === 'true';
        btn.setAttribute('aria-pressed', pressed ? 'false' : 'true');
        if (pressed) state.selected.delete(key); else state.selected.add(key);
        // Slå "Vis alt" fra når noget er valgt
        chipAll.setAttribute('aria-pressed', state.selected.size ? 'false' : 'true');
      }
      applyFilter();
    });

    // Klik på tag inde i artikel → filtrér på det tag (solo)
    document.addEventListener('click', e=>{
      const t = e.target.closest('.tag');
      if (!t) return;
      const raw = norm(t.textContent);
      // Find første chip der matcher dette tag via ALIASES
      let targetKey = null;
      // Hvis der findes en kanonisk key der dækker tagget, brug den
      for (const [key, list] of Object.entries(ALIASES)){
        if (list.map(norm).includes(raw)) { targetKey = key; break; }
      }
      // Fald tilbage til selve tagget
      if (!targetKey) targetKey = raw;
      // Nulstil og aktivér kun denne
      state.selected.clear();
      state.selected.add(targetKey);
      // Opdatér aria-pressed visuelt
      filters.querySelectorAll('.chip').forEach(c=>{
        if (c.dataset.key === '__all') { c.setAttribute('aria-pressed','false'); return; }
        c.setAttribute('aria-pressed', c.dataset.key === targetKey ? 'true' : 'false');
      });
      applyFilter();
    });

    // Læs initial hash (#tag=npc,lokation eller #npc,lokation)
    function initFromHash(){
      let h = decodeURIComponent(location.hash || '').replace(/^#/, '');
      if (!h) return applyFilter();
      if (h.startsWith('tag=')) h = h.slice(4);
      if (!h) return applyFilter();
      const parts = h.split(',').map(norm).filter(Boolean);
      state.selected.clear();
      parts.forEach(p=> state.selected.add(p));
      // Markér chips, hvis de findes
      filters.querySelectorAll('.chip').forEach(c=>{
        if (c.dataset.key === '__all'){ c.setAttribute('aria-pressed', state.selected.size ? 'false':'true'); return; }
        c.setAttribute('aria-pressed', state.selected.has(c.dataset.key) ? 'true':'false');
      });
      applyFilter();
    }

    window.addEventListener('hashchange', initFromHash);
    // Første kørsel
    initFromHash();
  </script>
</body>
</html>
